/* http://keith-wood.name/timeEntry.html
   https://github.com/telvue/timeentry
   Time entry for jQuery v2.0.1.
   Written by Keith Wood (kbwood{at}iinet.com.au) June 2007.
   Available under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license.
   Please attribute the author if you use it. */
!function(e){var n="timeEntry",t=!1;e.JQPlugin.createPlugin({name:n,defaultOptions:{appendText:"",showSeconds:!1,unlimitedHours:!1,timeSteps:[1,1,1],initialField:null,noSeparatorEntry:!0,tabToExit:!1,useMouseWheel:!0,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:!1,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null},regionalOptions:{"":{show24Hours:!1,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]}},_getters:["getOffset","getTime","isDisabled"],_appendClass:n+"-append",_controlClass:n+"-control",_expandClass:n+"-expand",_disabledInputs:[],_instSettings:function(e,n){return{_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0}},_postAttach:function(e,n){e.on("focus."+n.name,this._doFocus).on("blur."+n.name,this._doBlur).on("click."+n.name,this._doClick).on("keydown."+n.name,this._doKeyDown).on("keypress."+n.name,this._doKeyPress).on("paste."+n.name,function(e){setTimeout(function(){i._parseTime(n)},1)})},_optionsChanged:function(n,t,i){var s=this._extractTime(t);e.extend(t.options,i),t.options.show24Hours=t.options.show24Hours||t.options.unlimitedHours,t._field=0,s&&this._setTime(t,new Date(0,0,0,s[0],s[1],s[2])),n.next("span."+this._appendClass).remove(),n.parent().find("span."+this._controlClass).remove(),e.fn.mousewheel&&n.unmousewheel();var o=t.options.spinnerImage?e('<span class="'+this._controlClass+'" style="display: inline-block; background: url(\''+t.options.spinnerImage+"') 0 0 no-repeat; width: "+t.options.spinnerSize[0]+"px; height: "+t.options.spinnerSize[1]+'px;"></span>'):null;n.after(t.options.appendText?'<span class="'+this._appendClass+'">'+t.options.appendText+"</span>":"").after(o||""),t.options.useMouseWheel&&e.fn.mousewheel&&n.mousewheel(this._doMouseWheel),o&&o.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)},enable:function(e){this._enableDisable(e,!1)},disable:function(e){this._enableDisable(e,!0)},_enableDisable:function(n,t){var i=this._getInst(n);i&&(n.disabled=t,n.nextSibling&&"span"===n.nextSibling.nodeName.toLowerCase()&&this._changeSpinner(i,n.nextSibling,t?5:-1),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===n?null:e}),t&&this._disabledInputs.push(n))},isDisabled:function(n){return e.inArray(n,this._disabledInputs)>-1},_preDestroy:function(t,i){t=e(t).off("."+n),e.fn.mousewheel&&t.unmousewheel(),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t[0]?null:e}),t.siblings("."+this._appendClass+",."+this._controlClass).remove()},setTime:function(n,t){var i=this._getInst(n);i&&(null===t||""===t?e(n).val(""):this._setTime(i,t?e.isArray(t)?t:"object"==typeof t?new Date(t.getTime()):t:null))},getTime:function(e){var n=this._getInst(e),t=n?this._extractTime(n):null;return t?new Date(0,0,0,t[0],t[1],t[2]):null},getOffset:function(e){var n=this._getInst(e),t=n?this._extractTime(n):null;return t?(3600*t[0]+60*t[1]+t[2])*1e3:0},_doFocus:function(n){var t=n.nodeName&&"input"===n.nodeName.toLowerCase()?n:this;if(i._lastInput===t||i.isDisabled(t)){i._focussed=!1;return}var s=i._getInst(t);i._focussed=!0,i._lastInput=t,i._blurredInput=null,e.extend(s.options,e.isFunction(s.options.beforeShow)?s.options.beforeShow.apply(t,[t]):{}),i._parseTime(s,n.nodeName?null:n),setTimeout(function(){i._showField(s)},0)},_doBlur:function(e){i._blurredInput=i._lastInput,i._lastInput=null},_doClick:function(e){var n=e.target,t=i._getInst(n),s=t._field;i._focussed||(t._field=i._getSelection(t,n,e)),s!==t._field&&(t._lastChr=""),i._showField(t),i._focussed=!1},_getSelection:function(n,t,i){var s=0,o=[n.elem.val().split(n.options.separator)[0].length,2,2];if(null!==t.selectionStart)for(var r=0,a=0;a<=Math.max(1,n._secondField,n._ampmField)&&(r+=a!==n._ampmField?o[a]+n.options.separator.length:n.options.ampmPrefix.length+n.options.ampmNames[0].length,s=a,!(t.selectionStart<r));a++);else if(t.createTextRange&&null!=i)for(var l,p=e(i.srcElement),u=t.createTextRange(),d=i.clientX+document.documentElement.scrollLeft-(p.offset().left+parseInt({thin:2,medium:4,thick:6}[l=p.css("border-left-width")]||l,10))-u.offsetLeft,a=0;a<=Math.max(1,n._secondField,n._ampmField);a++){var r=a!==n._ampmField?a*fieldSize+2:n._ampmField*fieldSize+n.options.ampmPrefix.length+n.options.ampmNames[0].length;if(u.collapse(),u.moveEnd("character",r),s=a,d<u.boundingWidth)break}return s},_doKeyDown:function(e){if(e.keyCode>=48)return!0;var n=i._getInst(e.target);switch(e.keyCode){case 9:return!!n.options.tabToExit||(e.shiftKey?i._changeField(n,-1,!0):i._changeField(n,1,!0));case 35:e.ctrlKey?(i._setTime(n,null),setTimeout(function(){n._field=0,n.elem.val("")},0)):(n._field=Math.max(1,n._secondField,n._ampmField),i._adjustField(n,0));break;case 36:e.ctrlKey?i._setTime(n):(n._field=0,i._adjustField(n,0));break;case 37:i._changeField(n,-1,!1);break;case 38:i._adjustField(n,1);break;case 39:i._changeField(n,1,!1);break;case 40:i._adjustField(n,-1);break;case 46:i._setTime(n,null),setTimeout(function(){n._field=0,n.elem.val("")},0);break;case 8:n._lastChr="";default:return!0}return!1},_doKeyPress:function(e){var n=String.fromCharCode(void 0===e.charCode?e.keyCode:e.charCode);if(n<" "&&"*"!==n)return!0;var t=i._getInst(e.target);return i._handleKeyPress(t,n),!1},_handleKeyPress:function(e,n){if(n===e.options.separator)this._changeField(e,1,!1);else if("*"===n&&0===e._field)e._lastChr="*";else if(n>="0"&&n<="9"){0===e._field&&(t="1"===n&&"*"===e._lastChr);var i=parseInt(n,10),s=parseInt(e._lastChr+n,10),o=0!==e._field?e._selectedHour:e.options.unlimitedHours?s:e.options.show24Hours?s<24?s:i:(s>=1&&s<=12?s:i>0?i:e._selectedHour)%12+(e._selectedHour>=12?12:0),r=1!==e._field?e._selectedMinute:s<60?s:i,a=e._field!==e._secondField?e._selectedSecond:s<60?s:i,l=this._constrainTime(e,[o,r,a]);this._setTime(e,e.options.unlimitedHours?l:new Date(0,0,0,l[0],l[1],l[2])),e.options.noSeparatorEntry&&e._lastChr?this._changeField(e,1,!1):e._lastChr=e.options.unlimitedHours&&0===e._field?e._lastChr+n:n}else if(!e.options.show24Hours&&((n=n.toLowerCase())===e.options.ampmNames[0].substring(0,1).toLowerCase()&&e._selectedHour>=12||n===e.options.ampmNames[1].substring(0,1).toLowerCase()&&e._selectedHour<12)){var p=e._field;e._field=e._ampmField,this._adjustField(e,1),e._field=p,this._showField(e)}},_doMouseWheel:function(e,n){if(!i.isDisabled(e.target)){var t=i._getInst(e.target);t.elem.focus(),t.elem.val()||i._parseTime(t),i._adjustField(t,n),e.preventDefault()}},_expandSpinner:function(n){var t=i._getSpinnerTarget(n),s=i._getInst(i._getInput(t));if(!i.isDisabled(s.elem[0])&&s.options.spinnerBigImage){s._expanded=!0;var o=e(t).offset(),r=null;e(t).parents().each(function(){var n=e(this);return("relative"===n.css("position")||"absolute"===n.css("position"))&&(r=n.offset()),!r}),e('<div class="'+i._expandClass+'" style="position: absolute; left: '+(o.left-(s.options.spinnerBigSize[0]-s.options.spinnerSize[0])/2-(r?r.left:0))+"px; top: "+(o.top-(s.options.spinnerBigSize[1]-s.options.spinnerSize[1])/2-(r?r.top:0))+"px; width: "+s.options.spinnerBigSize[0]+"px; height: "+s.options.spinnerBigSize[1]+"px; background: transparent url("+s.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(i._handleSpinner).mouseup(i._endSpinner).mouseout(i._endExpand).mousemove(i._describeSpinner).insertAfter(t)}},_getInput:function(n){return e(n).siblings("."+this._getMarker())[0]},_describeSpinner:function(e){var n=i._getSpinnerTarget(e),t=i._getInst(i._getInput(n));n.title=t.options.spinnerTexts[i._getSpinnerRegion(t,e)]},_handleSpinner:function(n){var t=i._getSpinnerTarget(n),s=i._getInput(t);if(!i.isDisabled(s)){s===i._blurredInput&&(i._lastInput=s,i._blurredInput=null);var o=i._getInst(s);i._doFocus(s);var r=i._getSpinnerRegion(o,n);i._changeSpinner(o,t,r),i._actionSpinner(o,r),i._timer=null,i._handlingSpinner=!0,r>=3&&o.options.spinnerRepeat[0]&&(i._timer=setTimeout(function(){i._repeatSpinner(o,r)},o.options.spinnerRepeat[0]),e(t).one("mouseout",i._releaseSpinner).one("mouseup",i._releaseSpinner))}},_actionSpinner:function(e,n){switch(e.elem.val()||i._parseTime(e),n){case 0:this._setTime(e);break;case 1:this._changeField(e,-1,!1);break;case 2:this._changeField(e,1,!1);break;case 3:this._adjustField(e,1);break;case 4:this._adjustField(e,-1)}},_repeatSpinner:function(e,n){i._timer&&(i._lastInput=i._blurredInput,this._actionSpinner(e,n),this._timer=setTimeout(function(){i._repeatSpinner(e,n)},e.options.spinnerRepeat[1]))},_releaseSpinner:function(e){clearTimeout(i._timer),i._timer=null},_endExpand:function(n){i._timer=null;var t=i._getSpinnerTarget(n),s=i._getInput(t),o=i._getInst(s);e(t).remove(),o._expanded=!1},_endSpinner:function(e){i._timer=null;var n=i._getSpinnerTarget(e),t=i._getInput(n),s=i._getInst(t);i.isDisabled(t)||i._changeSpinner(s,n,-1),i._handlingSpinner&&(i._lastInput=i._blurredInput),i._lastInput&&i._handlingSpinner&&i._showField(s),i._handlingSpinner=!1},_getSpinnerTarget:function(e){return e.target||e.srcElement},_getSpinnerRegion:function(n,t){var i=this._getSpinnerTarget(t),s=e(i).offset(),o=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],r=n.options.spinnerIncDecOnly?99:t.clientX+o[0]-s.left,a=t.clientY+o[1]-s.top,l=n.options[n._expanded?"spinnerBigSize":"spinnerSize"],p=n.options.spinnerIncDecOnly?99:l[0]-1-r,u=l[1]-1-a;if(l[2]>0&&Math.abs(r-p)<=l[2]&&Math.abs(a-u)<=l[2])return 0;var d=Math.min(r,a,p,u);return d===r?1:d===p?2:d===a?3:4},_changeSpinner:function(n,t,i){e(t).css("background-position","-"+(i+1)*n.options[n._expanded?"spinnerBigSize":"spinnerSize"][0]+"px 0px")},_parseTime:function(e,n){var t=this._extractTime(e);if(t)e._selectedHour=t[0],e._selectedMinute=t[1],e._selectedSecond=t[2];else{var s=this._constrainTime(e);e._selectedHour=s[0],e._selectedMinute=s[1],e._selectedSecond=e.options.showSeconds?s[2]:0}e._secondField=e.options.showSeconds?2:-1,e._ampmField=e.options.show24Hours?-1:e.options.showSeconds?3:2,e._lastChr="";var o=function(){""!==e.elem.val()&&i._showTime(e)};"number"==typeof e.options.initialField?(e._field=Math.max(0,Math.min(Math.max(1,e._secondField,e._ampmField),e.options.initialField)),o()):setTimeout(function(){e._field=i._getSelection(e,e.elem[0],n),o()},0)},_extractTime:function(e,n){var i=(n=n||e.elem.val()).split(e.options.separator);if(""===e.options.separator&&""!==n&&(i[0]=n.substring(0,2),i[1]=n.substring(2,4),i[2]=n.substring(4,6)),i.length>=2){var s=!e.options.show24Hours&&n.indexOf(e.options.ampmNames[0])>-1,o=!e.options.show24Hours&&n.indexOf(e.options.ampmNames[1])>-1;"*1"==i[0]&&(t=!0,i[0]);var r=parseInt(i[0],10);r=isNaN(r)?0:r,r=((s||o)&&12===r?0:r)+(o?12:0);var a=parseInt(i[1],10);a=isNaN(a)?0:a;var l=i.length>=3?parseInt(i[2],10):0;return l=isNaN(l)||!e.options.showSeconds?0:l,this._constrainTime(e,[r,a,l])}return null},_constrainTime:function(e,n){var t=new Date;if(t.setHours(0),t.setMinutes(0),t.setSeconds(0),!(null!=n)){var i=this._determineTime(e.options.defaultTime,e)||t;n=[i.getHours(),i.getMinutes(),i.getSeconds()]}for(var s=!1,o=0;o<e.options.timeSteps.length;o++)s?n[o]=0:e.options.timeSteps[o]>1&&(n[o]=Math.round(n[o]/e.options.timeSteps[o])*e.options.timeSteps[o],s=!0);return n},_showTime:function(e){var n=(t?"*1":e.options.unlimitedHours?e._selectedHour:this._formatNumber(e.options.show24Hours?e._selectedHour:(e._selectedHour+11)%12+1))+e.options.separator+this._formatNumber(e._selectedMinute)+(e.options.showSeconds?e.options.separator+this._formatNumber(e._selectedSecond):"")+(e.options.show24Hours?"":e.options.ampmPrefix+e.options.ampmNames[e._selectedHour<12?0:1]);this._setValue(e,n),this._showField(e)},_showField:function(e){var n=e.elem[0];if(!e.elem.is(":hidden")&&i._lastInput===n){for(var t=[e.elem.val().split(e.options.separator)[0].length,2,2],s=0,o=0;o<e._field;)s+=t[o]+(o===Math.max(1,e._secondField)?0:e.options.separator.length),o++;var r=s+(e._field!==e._ampmField?t[o]:e.options.ampmPrefix.length+e.options.ampmNames[0].length);if(n.setSelectionRange)n.setSelectionRange(s,r);else if(n.createTextRange){var a=n.createTextRange();a.moveStart("character",s),a.moveEnd("character",r-e.elem.val().length),a.select()}n.disabled||n.focus()}},_formatNumber:function(e){return(e<10?"0":"")+e},_setValue:function(e,n){n!==e.elem.val()&&e.elem.val(n).trigger("change")},_changeField:function(e,n,t){var i=""===e.elem.val()||e._field===(-1===n?0:Math.max(1,e._secondField,e._ampmField));return i||(e._field+=n),this._showField(e),e._lastChr="",i&&t},_adjustField:function(e,n){""===e.elem.val()&&(n=0),e.options.unlimitedHours?this._setTime(e,[e._selectedHour+(0===e._field?n*e.options.timeSteps[0]:0),e._selectedMinute+(1===e._field?n*e.options.timeSteps[1]:0),e._selectedSecond+(e._field===e._secondField?n*e.options.timeSteps[2]:0)]):this._setTime(e,new Date(0,0,0,e._selectedHour+(0===e._field?n*e.options.timeSteps[0]:0)+(e._field===e._ampmField?12*n:0),e._selectedMinute+(1===e._field?n*e.options.timeSteps[1]:0),e._selectedSecond+(e._field===e._secondField?n*e.options.timeSteps[2]:0)))},_setTime:function(n,t){if(n.options.unlimitedHours&&e.isArray(t))var i=t;else var i=(t=this._determineTime(t,n))?[t.getHours(),t.getMinutes(),t.getSeconds()]:null;i=this._constrainTime(n,i),t=new Date(0,0,0,i[0],i[1],i[2]);var t=this._normaliseTime(t),s=this._normaliseTime(this._determineTime(n.options.minTime,n)),o=this._normaliseTime(this._determineTime(n.options.maxTime,n));if(n.options.unlimitedHours){for(;i[2]<0;)i[2]+=60,i[1]--;for(;i[2]>59;)i[2]-=60,i[1]++;for(;i[1]<0;)i[1]+=60,i[0]--;for(;i[1]>59;)i[1]-=60,i[0]++;s=null!=n.options.minTime&&e.isArray(n.options.minTime)?n.options.minTime:[0,0,0],i[0]<s[0]?i=s.slice(0,3):i[0]===s[0]&&(i[1]<s[1]?(i[1]=s[1],i[2]=s[2]):i[1]===s[1]&&i[2]<s[2]&&(i[2]=s[2])),null!=n.options.maxTime&&e.isArray(n.options.maxTime)&&(i[0]>n.options.maxTime[0]?i=n.options.maxTime.slice(0,3):i[0]===n.options.maxTime[0]&&(i[1]>n.options.maxTime[1]?(i[1]=n.options.maxTime[1],i[2]=n.options.maxTime[2]):i[1]===n.options.maxTime[1]&&i[2]>n.options.maxTime[2]&&(i[2]=n.options.maxTime[2])))}else s&&o&&s>o?t<s&&t>o&&(t=Math.abs(t-s)<Math.abs(t-o)?s:o):t=s&&t<s?s:o&&t>o?o:t,i[0]=t.getHours(),i[1]=t.getMinutes(),i[2]=t.getSeconds();e.isFunction(n.options.beforeSetTime)&&(t=n.options.beforeSetTime.apply(n.elem[0],[this.getTime(n.elem[0]),t,s,o]),i[0]=t.getHours(),i[1]=t.getMinutes(),i[2]=t.getSeconds()),n._selectedHour=i[0],n._selectedMinute=i[1],n._selectedSecond=i[2],this._showTime(n)},_determineTime:function(n,t){var s,o,r;return n?"string"==typeof n?function(e){var n=i._extractTime(t,e),s=new Date,o=n?n[0]:s.getHours(),r=n?n[1]:s.getMinutes(),a=n?n[2]:s.getSeconds();if(!n)for(var l=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g,p=l.exec(e);p;){switch(p[2]||"s"){case"s":case"S":a+=parseInt(p[1],10);break;case"m":case"M":r+=parseInt(p[1],10);break;case"h":case"H":o+=parseInt(p[1],10)}p=l.exec(e)}return s=new Date(0,0,10,o,r,a,0),/^!/.test(e)&&(s.getDate()>10?s=new Date(0,0,10,23,59,59):10>s.getDate()&&(s=new Date(0,0,10,0,0,0))),s}(n):"number"==typeof n?(s=n,(o=new Date).setTime(o.getTime()+1e3*s),o):e.isArray(n)?(r=n,new Date(0,0,0,r[0],r[1]||0,r[2]||0,0)):n:null},_normaliseTime:function(e){return e?(e.setFullYear(1900),e.setMonth(0),e.setDate(0),e):null}});var i=e.timeEntry}(jQuery);
